<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>5×5 Grid Shuffler</title>
<style>
  :root{
    --ink:#e6e8ef;--muted:#9aa3b2;
    --blue:#5ad3ff;--red:#ff4d6d;
    --radius:18px;--gap:12px;
    --cell-size:120px;
    --font-size:20px;
    --font-weight:800;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#000;color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:1200px;margin:auto;padding:12px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:8px;flex-wrap:wrap}
  header h1{font-weight:800;font-size:clamp(20px, 2.6vw, 34px);letter-spacing:0.2px;margin:0}
  .layout{display:grid;grid-template-columns:380px 1fr;gap:20px}
  @media (max-width:980px){.layout{grid-template-columns:1fr}}
  .card{background:transparent;border:none;border-radius:var(--radius);padding:8px}

  textarea{width:100%;height:200px;background:#0e1320;color:var(--ink);border:1px solid #273149;outline:none;border-radius:12px;padding:8px;resize:vertical}
  .controls{display:grid;gap:8px;margin-top:8px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  label{display:flex;align-items:center;gap:6px;color:var(--muted);font-size:0.9rem}
  input[type="range"]{width:100px}
  input[type="text"],input[type="number"]{background:#0e1320;border:1px solid #273149;color:var(--ink);border-radius:10px;padding:4px 8px;min-width:0}

  .btn{appearance:none;border:none;border-radius:14px;padding:8px 12px;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(90deg,var(--blue),var(--red));color:#0b0e14}
  .btn.ghost{background:transparent;border:1px solid #2a3552;color:var(--ink)}
  .btn:active{transform:translateY(1px)}

  .grid{
    display:grid;
    grid-template-columns: repeat(5, var(--cell-size));
    gap: var(--gap);
    justify-content: center;
    width: 100%;
  }

  .cell{
    width: var(--cell-size);
    height: var(--cell-size);
    display:flex;align-items:center;justify-content:center;
    text-align:center;padding:12px;
    border-radius:16px;position:relative;overflow:hidden;cursor:pointer;
    border:3px solid transparent;
    border-image:linear-gradient(135deg,var(--blue),var(--red)) 1;
  }
  .cell .glow{position:absolute;inset:-2px;border-radius:inherit;background:
    radial-gradient(120% 150% at 20% -10%, rgba(90,211,255,.18), transparent 60%),
    radial-gradient(120% 150% at 120% 120%, rgba(255,77,109,.16), transparent 60%);
    opacity:.0;filter:saturate(140%);transition:opacity .2s ease}
  .cell:hover .glow,.cell.crossed .glow{opacity:.9}

  .cell .txt{
    position:relative;
    font-size:var(--font-size);
    font-weight:var(--font-weight);
    letter-spacing:.2px;
    text-shadow:0 0 1px rgba(0,0,0,.4), 0 1px 2px rgba(0,0,0,.35);
    line-height:1.2;
    word-break:break-word;
  }

  .cell.crossed .txt{
    text-decoration: line-through;
    text-decoration-thickness: 3px;
    text-decoration-color: rgba(255,255,255,.9);
    opacity:.9;
  }
  .cell.crossed::before{
    content:"";
    position:absolute; left:8%; right:8%; top:50%; height:3px;
    background:linear-gradient(90deg,var(--blue),var(--red));
    box-shadow:0 0 10px rgba(255,77,109,.45),0 0 12px rgba(90,211,255,.35);
    transform:translateY(-1px)
  }

  .cell.bingo-row,.cell.bingo-col{
    outline:2px solid transparent;
    box-shadow:0 0 18px rgba(90,211,255,.45), 0 0 26px rgba(255,77,109,.35)
  }
  .cell.bingo-row .glow,.cell.bingo-col .glow{opacity:1}
  .cell.bingo-row{animation:blinkBlue 1.2s ease-in-out infinite alternate}
  .cell.bingo-col{animation:blinkRed 1.2s ease-in-out infinite alternate}
  @keyframes blinkBlue{from{filter:none} to{filter:drop-shadow(0 0 10px var(--blue))}}
  @keyframes blinkRed{from{filter:none} to{filter:drop-shadow(0 0 10px var(--red))}}

  .obs-mode .layout{grid-template-columns:1fr}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>5×5 Grid Shuffler</h1>
    <div class="row">
      <label>Font Size <input type="range" id="fontSize" min="12" max="60"></label>
      <label>Cell Size <input type="range" id="cellSize" min="80" max="200"></label>
      <label><input type="checkbox" id="boldToggle" checked> Bold</label>
    </div>
  </header>

  <div class="layout">
    <section class="card" id="editorPanel">
      <label for="items"><strong>List</strong> (one per line)</label>
      <textarea id="items" placeholder="Enter at least 25 lines…"></textarea>
      <div class="controls">
        <div class="row">
          <button id="btnFill" class="btn primary">Shuffle & Fill</button>
          <button id="btnAgain" class="btn ghost">Shuffle Again</button>
          <button id="btnClearCrosses" class="btn ghost">Clear Crosses</button>
          <button id="btnClear" class="btn ghost">Clear</button>
        </div>
        <div class="row">
          <label><input type="checkbox" id="allowRepeats"> Allow repeats</label>
          <label>Seed <input id="seed" type="text" placeholder="optional" /></label>
        </div>
        <div id="status"></div>
      </div>
    </section>
    <section class="card">
      <div class="grid" id="grid" aria-live="polite"></div>
    </section>
  </div>
</div>

<script>
const $ = s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const OBS_MODE = new URLSearchParams(location.search).has("obs");
const STORAGE_KEY="gridshuffler:state";
let bc; try{bc=new BroadcastChannel("gridshuffler:channel");}catch{bc=null;}

function seedRNG(s){if(!s)return Math.random;let h=1779033703^s.split('').reduce((a,c)=>((a<<5)-a)+c.charCodeAt(0)|0,0);h=Math.imul(h^(h>>>16),2246822507);h=Math.imul(h^(h>>>13),3266489909);return()=>{h=(h+0x6D2B79F5)|0;let t=Math.imul(h^(h>>>15),1|h);t^=t+Math.imul(t^(t>>>7),61|t);return((t^(t>>>14))>>>0)/4294967296}}
function shuffle(a,r=Math.random){a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(r()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
function sample25(lines,allow,rnd){const cl=lines.map(s=>s.trim()).filter(Boolean);if(!cl.length)return Array(25).fill("");if(cl.length>=25)return shuffle(cl,rnd).slice(0,25);if(!allow)throw new Error(`Need ${25-cl.length} more items or enable repeats.`);const out=[];let pool=shuffle(cl,rnd);while(out.length<25){if(!pool.length)pool=shuffle(cl,rnd);out.push(pool.pop())}return out;}
function getTexts(){return $$('.cell .txt').map(n=>n.textContent)}
function getCrossed(){return $$('.cell').map(n=>n.classList.contains('crossed'))}
function crossedMatrix(){const a=getCrossed();return Array.from({length:5},(_,r)=>a.slice(r*5,(r+1)*5))}
function getCell(r,c){return document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`)}

function renderGrid(items){
  grid.innerHTML='';
  items.forEach((txt,i)=>{
    const r=Math.floor(i/5),c=i%5;
    const cell=document.createElement('div');
    cell.className='cell'; cell.dataset.row=r; cell.dataset.col=c;
    cell.innerHTML=`<div class="txt">${txt||' '}</div><div class="glow"></div>`;
    cell.addEventListener('click',()=>{cell.classList.toggle('crossed');updateBingos();publishState()});
    grid.appendChild(cell);
  });
  updateBingos();
}
function updateBingos(){
  $$('.cell').forEach(c=>c.classList.remove('bingo-row','bingo-col'));
  const m=crossedMatrix();
  for(let r=0;r<5;r++)if([0,1,2,3,4].every(c=>m[r][c]))for(let c=0;c<5;c++)getCell(r,c)?.classList.add('bingo-row');
  for(let c=0;c<5;c++)if([0,1,2,3,4].every(r=>m[r][c]))for(let r=0;r<5;r++)getCell(r,c)?.classList.add('bingo-col');
}
function fillFromTextarea(){
  try{
    const lines=(items?.value||'').split(/\r?\n/);
    const rnd=seedRNG((seed?.value||'').trim());
    const arr=sample25(lines,allowRepeats?.checked,rnd);
    renderGrid(arr);
    publishState();
  }catch(e){status.textContent=e.message}
}
function currentState(){return{items:items?.value||'',allow:allowRepeats?.checked,seed:seed?.value||'',texts:getTexts(),crossed:getCrossed(),settings:getSettings()}}
function publishState(){
  const st=currentState();
  localStorage.setItem(STORAGE_KEY,JSON.stringify(st));
  if(bc)bc.postMessage({type:'state',state:st});
}
function applyState(st){
  const arr=st?.texts?.length?st.texts:(st?.items?st.items.split(/\r?\n/):Array(25).fill(''));
  renderGrid(arr);
  if(st?.crossed)$$('.cell').forEach((c,i)=>st.crossed[i]&&c.classList.add('crossed'));
  applySettings(st?.settings);
  if(items)items.value=st.items||'';
  if(allowRepeats)allowRepeats.checked=!!st.allow;
  if(seed)seed.value=st.seed||'';
}
if(bc)bc.onmessage=e=>{if(e.data.type==='state')applyState(e.data.state)};
window.addEventListener('storage',e=>{if(e.key===STORAGE_KEY&&e.newValue)applyState(JSON.parse(e.newValue))});

btnFill?.addEventListener('click',fillFromTextarea);
btnAgain?.addEventListener('click',()=>{if(!items.value.trim())return;fillFromTextarea()});
btnClear?.addEventListener('click',()=>{items.value='';renderGrid(Array(25).fill(''));publishState()});
btnClearCrosses?.addEventListener('click',()=>{$$('.cell.crossed').forEach(c=>c.classList.remove('crossed'));updateBingos();publishState()});

function getSettings(){return{font:fontSize.value,cell:cellSize.value,bold:boldToggle.checked}}
function applySettings(s){
  if(!s)return;
  document.documentElement.style.setProperty('--font-size',s.font+'px');
  document.documentElement.style.setProperty('--cell-size',s.cell+'px');
  document.documentElement.style.setProperty('--font-weight',s.bold?'800':'400');
  fontSize.value=s.font;cellSize.value=s.cell;boldToggle.checked=s.bold;
}
[fontSize,cellSize,boldToggle].forEach(el=>el.addEventListener('input',()=>{
  document.documentElement.style.setProperty('--font-size',fontSize.value+'px');
  document.documentElement.style.setProperty('--cell-size',cellSize.value+'px');
  document.documentElement.style.setProperty('--font-weight',boldToggle.checked?'800':'400');
  publishState();
}));

(function init(){
  const s=localStorage.getItem(STORAGE_KEY);
  if(s)applyState(JSON.parse(s));else renderGrid(Array(25).fill(''));
})();
</script>
</body>
</html>
